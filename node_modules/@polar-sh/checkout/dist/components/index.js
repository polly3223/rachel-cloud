"use client";import{a as Ne}from"../chunk-KIJKY4TU.js";import{CountryAlpha2Input as $t}from"@polar-sh/sdk/models/components/addressinput";import oe from"@polar-sh/ui/components/atoms/Button";import Ut from"@polar-sh/ui/components/atoms/CountryPicker";import Et from"@polar-sh/ui/components/atoms/CountryStatePicker";import Ot from"@polar-sh/ui/components/atoms/FormattedDateTime";import q from"@polar-sh/ui/components/atoms/Input";import{Checkbox as Vt}from"@polar-sh/ui/components/ui/checkbox";import{Form as Wt,FormControl as D,FormField as w,FormItem as j,FormLabel as z,FormMessage as T}from"@polar-sh/ui/components/ui/form";import{cn as Ht}from"@polar-sh/ui/lib/utils";import{Elements as _t,ElementsConsumer as Zt,PaymentElement as jt}from"@stripe/react-stripe-js";import{loadStripe as zt}from"@stripe/stripe-js";import{useCallback as X,useEffect as Le,useMemo as J}from"react";import{useCallback as it,useRef as at}from"react";var Ie=(t,e,o)=>{let n=at();return it((...i)=>{n.current!=null&&clearTimeout(n.current),n.current=setTimeout(()=>{t(...i)},e)},[t,e,...o||[]])},Ae=Ie;var B=t=>t==="required"||t==="optional",H=t=>t==="required";var v=(t,e,o,n)=>new Intl.NumberFormat("en-US",{style:"currency",currency:e,minimumFractionDigits:o,maximumFractionDigits:n}).format(t/100),Me=(t,e)=>v(t,e,2,14);var lt=t=>t.type==="fixed",ut=t=>t.type==="percentage",ct=new Intl.NumberFormat("en-US",{style:"percent",maximumFractionDigits:2}),Ce=t=>{if(ut(t))return ct.format(-t.basisPoints/1e4);if(lt(t))return v(-t.amount,t.currency,0);throw new Error("Unknown discount type")};var mt=new Intl.PluralRules("en",{type:"ordinal"}),dt={zero:"",one:"st",two:"nd",few:"rd",many:"",other:"th"},Be=t=>{let e=mt.select(t),o=dt[e];return t+o},ge=(t,e,o="long")=>{if(!t)return"";let n=e&&e>1?e:null,i=n?`${Be(n)} `:"";if(o==="short")switch(t){case"day":return`${i}dy`;case"week":return`${i}wk`;case"month":return`${i}mo`;case"year":return`${i}yr`;default:return""}return`${i}${t}`},qe=(t,e)=>{if(!t)return"";let o=e&&e>1?e:null;if(o)return`every ${Be(o)} ${t}`;switch(t){case"day":return"daily";case"week":return"weekly";case"month":return"monthly";case"year":return"yearly";default:return t}},re=t=>"legacy"in t,_=t=>t.some(re),pt=t=>t.amountType==="metered_unit",he=t=>t.filter(pt);import{useMemo as $e}from"react";import{jsx as Ct,jsxs as gt}from"react/jsx-runtime";var ft=({amount:t,currency:e,interval:o,intervalCount:n})=>{let i=$e(()=>{if(!o)return"";let f=ge(o,n,"short");return f?` / ${f}`:""},[o,n]),m=$e(()=>t%100===0?0:2,[t]);return gt("div",{className:"flex flex-row items-baseline gap-x-1",children:[v(t,e,m),i?Ct("span",{className:"text-[max(12px,0.5em)]",children:i}):null]})},Z=ft;import Te from"@polar-sh/ui/components/atoms/Input";import{Select as ht,SelectContent as bt,SelectItem as yt,SelectTrigger as xt,SelectValue as Pt}from"@polar-sh/ui/components/atoms/Select";import vt from"@polar-sh/ui/components/atoms/TextArea";import{Checkbox as Ft}from"@polar-sh/ui/components/ui/checkbox";import{FormControl as Ue,FormDescription as kt,FormItem as Ee,FormLabel as wt,FormMessage as Oe}from"@polar-sh/ui/components/ui/form";import Ve from"markdown-to-jsx";import{Fragment as De,jsx as u,jsxs as be}from"react/jsx-runtime";var We={disableParsingRawHTML:!0,forceBlock:!1,overrides:{h1:t=>u("span",{...t}),h2:t=>u("span",{...t}),h3:t=>u("span",{...t}),h4:t=>u("span",{...t}),h5:t=>u("span",{...t}),h6:t=>u("span",{...t}),p:t=>u("span",{...t}),embed:()=>u(De,{}),iframe:()=>u(De,{}),img:()=>u(De,{}),a:t=>u("a",{...t,rel:"noopener noreferrer nofollow",target:"_blank",className:"text-blue-400 hover:underline"})}},He=({customField:t})=>u(wt,{children:t.properties.formLabel?u(Ve,{options:We,children:t.properties.formLabel}):t.name}),_e=({customField:t})=>t.properties.formHelpText?u(kt,{children:u(Ve,{options:We,children:t.properties.formHelpText})}):null,Nt=({customField:t,required:e,field:o,themePreset:n})=>t.properties.textarea?u(vt,{...o,placeholder:t.properties.formPlaceholder,required:e,minLength:t.properties.minLength,maxLength:t.properties.maxLength}):u(Te,{...o,className:"bg-white shadow-xs",type:"text",placeholder:t.properties.formPlaceholder,required:e,minLength:t.properties.minLength,maxLength:t.properties.maxLength}),It=({customField:t,required:e,field:o,themePreset:n})=>u(Te,{...o,type:"number",className:"bg-white shadow-xs",placeholder:t.properties.formPlaceholder,required:e,min:t.properties.ge,max:t.properties.le}),Dt=({customField:t,required:e,field:o,themePreset:n})=>{let{ge:i,le:m}=t.properties,f=i?new Date(i*1e3).toISOString().slice(0,10):void 0,y=m?new Date(m*1e3).toISOString().slice(0,10):void 0;return u(Te,{...o,type:"date",className:"bg-white shadow-xs",placeholder:t.properties.formPlaceholder,required:e,min:f,max:y})},Ze=({customField:t,required:e,field:o,themePreset:n})=>be(Ee,{children:[be("div",{className:"flex flex-row items-center space-y-0 space-x-3",children:[u(Ue,{children:u(Ft,{defaultChecked:o.value,onCheckedChange:o.onChange,required:e})}),u(He,{customField:t})]}),u(Oe,{}),u(_e,{customField:t})]}),Tt=({customField:t,required:e,field:o})=>be(ht,{onValueChange:o.onChange,defaultValue:o.value,required:e,children:[u(xt,{children:u(Pt,{placeholder:t.properties.formPlaceholder})}),u(bt,{children:t.properties.options.map(({label:n,value:i})=>u(yt,{value:i,textValue:n,children:n},i))})]}),Lt=t=>{switch(t.type){case"text":return Nt;case"number":return It;case"date":return Dt;case"checkbox":return Ze;case"select":return Tt}},Rt=({customField:t,required:e,field:o,themePreset:n})=>{let i=Lt(t);return t.type==="checkbox"?u(Ze,{customField:t,required:e,field:o,themePreset:n}):be(Ee,{children:[u(He,{customField:t}),u(Ue,{children:u(i,{customField:t,required:e,field:o,themePreset:n})}),u(Oe,{}),u(_e,{customField:t})]})},je=Rt;import{jsx as At,jsxs as Mt}from"react/jsx-runtime";var St=({price:t})=>Mt("div",{className:"flex flex-row items-baseline gap-x-1",children:[Me(Number.parseFloat(t.unitAmount),t.priceCurrency),At("span",{className:"dark:text-polar-400 text-[max(12px,0.5em)] text-gray-500",children:"/ unit"})]}),ye=St;import{jsx as E,jsxs as qt}from"react/jsx-runtime";var Bt=({className:t,width:e,height:o})=>qt("svg",{viewBox:"0 0 80 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,width:e,height:o,children:[E("path",{d:"M31.1672 19.1539V4.18967H37.1316C37.9154 4.18967 38.628 4.38919 39.2694 4.78824C39.9107 5.17303 40.4166 5.70746 40.7871 6.39154C41.1719 7.07561 41.3643 7.83808 41.3643 8.67893C41.3643 9.54825 41.1719 10.3322 40.7871 11.0304C40.4166 11.7288 39.9107 12.2846 39.2694 12.6979C38.628 13.1112 37.9154 13.3178 37.1316 13.3178H33.0271V19.1539H31.1672ZM33.0271 11.5007H37.1743C37.6019 11.5007 37.9866 11.3796 38.3287 11.1373C38.6708 10.8808 38.9415 10.5387 39.1411 10.1113C39.3406 9.68368 39.4404 9.20623 39.4404 8.67893C39.4404 8.16586 39.3406 7.70982 39.1411 7.31077C38.9415 6.91173 38.6708 6.59106 38.3287 6.34878C37.9866 6.1065 37.6019 5.98537 37.1743 5.98537H33.0271V11.5007Z",fill:"currentColor"}),E("path",{d:"M48.2523 19.3676C47.155 19.3676 46.1716 19.1182 45.3023 18.6194C44.4471 18.1064 43.7703 17.4152 43.2714 16.5458C42.7726 15.6622 42.5232 14.6575 42.5232 13.5316C42.5232 12.4058 42.7726 11.4081 43.2714 10.5387C43.7703 9.66937 44.4471 8.98533 45.3023 8.48653C46.1716 7.98771 47.155 7.73831 48.2523 7.73831C49.3497 7.73831 50.3259 7.98771 51.1811 8.48653C52.0504 8.98533 52.7273 9.66937 53.2119 10.5387C53.7107 11.4081 53.9601 12.4058 53.9601 13.5316C53.9601 14.6575 53.7107 15.6622 53.2119 16.5458C52.7273 17.4152 52.0504 18.1064 51.1811 18.6194C50.3259 19.1182 49.3497 19.3676 48.2523 19.3676ZM48.2523 17.7002C49.0077 17.7002 49.6775 17.5221 50.2618 17.1658C50.8461 16.7952 51.3022 16.2964 51.63 15.6694C51.972 15.0423 52.1359 14.3297 52.1217 13.5316C52.1359 12.7335 51.972 12.0281 51.63 11.4153C51.3022 10.7882 50.8461 10.2965 50.2618 9.94015C49.6775 9.58391 49.0077 9.40576 48.2523 9.40576C47.497 9.40576 46.82 9.58391 46.2214 9.94015C45.6372 10.2965 45.1811 10.7882 44.8534 11.4153C44.5255 12.0423 44.3617 12.7478 44.3617 13.5316C44.3617 14.3297 44.5255 15.0423 44.8534 15.6694C45.1811 16.2964 45.6372 16.7952 46.2214 17.1658C46.82 17.5221 47.497 17.7002 48.2523 17.7002Z",fill:"currentColor"}),E("path",{d:"M55.9135 19.1539V3.33456H57.7092V19.1539H55.9135Z",fill:"currentColor"}),E("path",{d:"M64.7936 19.3676C63.8388 19.3676 62.9694 19.1182 62.1856 18.6194C61.416 18.1064 60.8032 17.408 60.3471 16.5244C59.8911 15.6409 59.6631 14.6432 59.6631 13.5316C59.6631 12.4058 59.8982 11.4081 60.3685 10.5387C60.8388 9.66937 61.4659 8.98533 62.2497 8.48653C63.0478 7.98771 63.9386 7.73831 64.9219 7.73831C65.5062 7.73831 66.0407 7.82383 66.5252 7.99484C67.024 8.16586 67.4658 8.40814 67.8507 8.72167C68.2354 9.02096 68.5561 9.37725 68.8126 9.7905C69.0691 10.1896 69.2401 10.6171 69.3257 11.0732L68.8554 10.8594L68.8767 7.97347H70.6724V19.1539H68.8767V16.439L69.3257 16.2038C69.2259 16.617 69.0335 17.0161 68.7485 17.401C68.4777 17.7857 68.1357 18.1277 67.7224 18.427C67.3233 18.7121 66.8744 18.9401 66.3756 19.1111C65.8767 19.2821 65.3495 19.3676 64.7936 19.3676ZM65.2212 17.6788C65.9481 17.6788 66.5894 17.5007 67.1452 17.1444C67.701 16.7881 68.1428 16.3035 68.4706 15.6907C68.7983 15.0636 68.9623 14.3439 68.9623 13.5316C68.9623 12.7335 68.7983 12.0281 68.4706 11.4153C68.157 10.8025 67.7152 10.3178 67.1452 9.96161C66.5894 9.60528 65.9481 9.42711 65.2212 9.42711C64.4943 9.42711 63.853 9.60528 63.2973 9.96161C62.7414 10.3178 62.2996 10.8025 61.9718 11.4153C61.6583 12.0281 61.5016 12.7335 61.5016 13.5316C61.5016 14.3297 61.6583 15.0423 61.9718 15.6694C62.2996 16.2964 62.7414 16.7881 63.2973 17.1444C63.853 17.5007 64.4943 17.6788 65.2212 17.6788Z",fill:"currentColor"}),E("path",{d:"M72.9796 19.1539V7.97346H74.7753L74.818 11.116L74.6257 10.5815C74.7824 10.0542 75.0389 9.57676 75.3953 9.14922C75.7515 8.72167 76.1719 8.37964 76.6565 8.1231C77.1553 7.86658 77.6826 7.73831 78.2384 7.73831C78.4807 7.73831 78.7088 7.7597 78.9225 7.80244C79.1506 7.83095 79.3358 7.8737 79.4783 7.93071L78.9866 9.91878C78.8014 9.83332 78.609 9.76914 78.4095 9.72641C78.2099 9.68368 78.0246 9.66231 77.8536 9.66231C77.3976 9.66231 76.9772 9.74777 76.5924 9.91878C76.2218 10.0898 75.9012 10.325 75.6304 10.6243C75.3738 10.9093 75.1672 11.2442 75.0104 11.629C74.8679 12.0138 74.7967 12.4271 74.7967 12.8689V19.1539H72.9796Z",fill:"currentColor"}),E("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.08734 21.1119C10.2671 24.6182 17.3085 23.2616 20.8148 18.0818C24.3211 12.9021 22.9645 5.86065 17.7848 2.35436C12.605 -1.15192 5.56353 0.204698 2.05724 5.38446C-1.44904 10.5642 -0.0924184 17.6057 5.08734 21.1119ZM6.58958 21.2045C11.3278 23.6286 17.3384 21.3531 20.0147 16.1221C22.6909 10.891 21.0194 4.68533 16.2811 2.2612C11.543 -0.162919 5.53235 2.11252 2.8561 7.34355C0.179842 12.5745 1.85138 18.7803 6.58958 21.2045Z",fill:"currentColor"}),E("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.93988 22.4416C12.2169 23.8337 17.2485 20.1561 19.1782 14.2276C21.1078 8.29898 19.2047 2.3644 14.9276 0.9723C10.6505 -0.419794 5.61905 3.25775 3.68942 9.18633C1.7598 15.1149 3.6628 21.0495 7.93988 22.4416ZM9.24825 21.991C12.868 22.7631 16.7819 18.796 17.9904 13.1305C19.1988 7.46494 17.244 2.24622 13.6243 1.47416C10.0046 0.702105 6.09064 4.66908 4.88222 10.3347C3.67381 16.0002 5.62854 21.2189 9.24825 21.991Z",fill:"currentColor"}),E("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.2406 22.9252C13.1024 23.2308 15.9585 18.4574 16.6199 12.2635C17.2812 6.06969 15.4974 0.800854 12.6356 0.495275C9.77386 0.189695 6.91772 4.96309 6.25634 11.157C5.59498 17.3508 7.37878 22.6196 10.2406 22.9252ZM11.5798 21.04C13.6508 21.0073 15.264 16.8146 15.1828 11.6754C15.1017 6.53608 13.3568 2.39642 11.2858 2.42914C9.21463 2.46187 7.60148 6.65457 7.68268 11.7939C7.76387 16.9331 9.50864 21.0727 11.5798 21.04Z",fill:"currentColor"})]}),ze=Bt;import{Fragment as G,jsx as r,jsxs as l}from"react/jsx-runtime";var O=({title:t,emphasis:e,children:o})=>l("div",{className:`flex flex-row items-start justify-between gap-x-8 ${e?"font-medium":"dark:text-polar-500 text-gray-500"}`,children:[r("span",{children:t}),o]}),Ge=({className:t})=>l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[r("path",{d:"M18 6 6 18"}),r("path",{d:"m6 6 12 12"})]}),Ke=({form:t,checkout:e,confirm:o,update:n,loading:i,loadingLabel:m,disabled:f,isUpdatePending:y,children:N,themePreset:a,subscribeNowButtonExperiment:C,payNowButtonExperiment:P})=>{let d=Ne(e)?_(e.prices[e.product.id])?e.productPrice.recurringInterval:e.product.recurringInterval:null,c=Ne(e)?e.product.recurringIntervalCount:null,{control:g,handleSubmit:ue,watch:K,clearErrors:x,resetField:h,setValue:$,formState:{errors:R}}=t,M=e.discount,ce=M&&M.code===null,{product:ee,prices:te,isBusinessCustomer:me}=e,Y=J(()=>ee&&te?he(te[ee.id]):[],[ee]),ve=K("customerBillingAddress.country"),de=X(async(s,{name:b})=>{if(!b)return;let k={};if(b==="customerBillingAddress.country"){let{customerBillingAddress:S}=s;S&&S.country&&(k={...k,customerBillingAddress:{country:S.country}})}else if(b.startsWith("customerBillingAddress")){let{customerBillingAddress:S}=s;S&&S.country&&(k={...k,customerBillingAddress:{...S,country:S.country}},x("customerBillingAddress"))}if(Object.keys(k).length!==0)try{await n(k)}catch{}},[x,n]),pe=Ie(de,500,[de]),U=K("discountCode"),Fe=X(async()=>{if(U){x("discountCode");try{await n({discountCode:U})}catch{}}},[n,U,x]),fe=X(async()=>{x("discountCode");try{await n({discountCode:null}),h("discountCode")}catch{}},[n,x,h]);Le(()=>{!U&&!e.discount&&x("discountCode")},[U,e.discount,x]);let p=X(async s=>{try{await n({isBusinessCustomer:s})}catch{}},[n]);Le(()=>{let s=K(pe);return()=>s.unsubscribe()},[K,pe]);let I=K("customerTaxId"),tt=X(async()=>{if(I){x("customerTaxId");try{await n({customerTaxId:I})}catch{}}},[n,I,x]),rt=X(async()=>{x("customerTaxId");try{await n({customerTaxId:null}),h("customerTaxId")}catch{}},[n,x,h]),ot=async s=>{let b=s.customFieldData?Object.fromEntries(Object.entries(s.customFieldData).filter(([k,S])=>S!=null)):{};(s.discountCode===""||!s.discountCode&&ce)&&delete s.discountCode,await o({...s,customFieldData:b})},ke=!!e.discount,we=!!e.customerTaxId;Le(()=>{e.discount||h("discountCode")},[e,h]);let Se=J(()=>{if(!e.discount||!d||e.discount.duration==="forever")return"";if(e.discount.duration==="once"){if(c&&c>1){let k=`${d}${c>1?"s":""}`;return`for the first ${c} ${k}`}return`for the first ${d}`}let s="durationInMonths"in e.discount&&e.discount?e.discount.durationInMonths:-1,b=d==="year"?Math.ceil(s/12):s;if(b<=1){if(c&&c>1){let k=`${d}${c>1?"s":""}`;return`for the first ${c} ${k}`}return`for the first ${d}`}return`for the first ${b} ${d==="year"?"years":"months"}`},[e.discount,d,c]),st=J(()=>d?`Every ${ge(d,c,"long")}`:"Total",[d,c]),nt=J(()=>e.activeTrialInterval?"Start Trial":e.isPaymentFormRequired?d?C?"Subscribe now":"Subscribe":P?"Pay now":"Pay":"Submit",[e,d,C,P]);return l("div",{className:"flex flex-col justify-between gap-y-24",children:[l("div",{className:"flex flex-col gap-y-12",children:[r(Wt,{...t,children:l("form",{onSubmit:ue(ot),className:"flex flex-col gap-y-12",children:[l("div",{className:"flex flex-col gap-y-6",children:[r(w,{control:g,name:"customerEmail",rules:{required:"This field is required"},render:({field:s})=>l(j,{children:[r(z,{children:"Email"}),r(D,{children:r(q,{type:"email",autoComplete:"email",...s,value:s.value||"",disabled:e.customerId!==null})}),r(T,{})]})}),N,e.isPaymentFormRequired&&r(w,{control:g,name:"customerName",rules:{required:"This field is required"},render:({field:s})=>l(j,{children:[r(z,{children:"Cardholder name"}),r(D,{children:r(q,{type:"text",autoComplete:"name",...s,value:s.value||""})}),r(T,{})]})}),(e.isPaymentFormRequired||e.requireBillingAddress)&&l(G,{children:[r(w,{control:g,name:"isBusinessCustomer",render:({field:s})=>l(j,{children:[l("div",{className:"flex flex-row items-center space-y-0 space-x-3",children:[r(D,{children:r(Vt,{checked:s.value?s.value:!1,onCheckedChange:b=>{y||(s.onChange(b),p(!!b))}})}),r(z,{children:"I'm purchasing as a business"})]}),r(T,{})]})}),me&&r(w,{control:g,name:"customerBillingName",rules:{required:"This field is required"},render:({field:s})=>l(j,{children:[r(z,{children:"Business name"}),r(D,{children:r(q,{type:"text",autoComplete:"billing organization",...s,value:s.value||""})}),r(T,{})]})}),l(j,{children:[r(z,{children:"Billing address"}),B(e.billingAddressFields.line1)&&r(D,{children:r(w,{control:g,name:"customerBillingAddress.line1",rules:{required:H(e.billingAddressFields.line1)?"This field is required":!1},render:({field:s})=>l(G,{children:[r(q,{type:"text",autoComplete:"billing address-line1",placeholder:"Line 1",...s,value:s.value||""}),r(T,{})]})})}),B(e.billingAddressFields.line2)&&r(D,{children:r(w,{control:g,name:"customerBillingAddress.line2",rules:{required:H(e.billingAddressFields.line2)?"This field is required":!1},render:({field:s})=>l(G,{children:[r(q,{type:"text",autoComplete:"billing address-line2",placeholder:"Line 2",...s,value:s.value||""}),r(T,{})]})})}),(B(e.billingAddressFields.postalCode)||B(e.billingAddressFields.city))&&l("div",{className:"grid grid-cols-2 gap-x-2",children:[B(e.billingAddressFields.postalCode)&&r(D,{children:r(w,{control:g,name:"customerBillingAddress.postalCode",rules:{required:H(e.billingAddressFields.postalCode)?"This field is required":!1},render:({field:s})=>l("div",{children:[r(q,{type:"text",autoComplete:"billing postal-code",placeholder:"Postal code",...s,value:s.value||""}),r(T,{})]})})}),B(e.billingAddressFields.city)&&r(D,{children:r(w,{control:g,name:"customerBillingAddress.city",rules:{required:H(e.billingAddressFields.city)?"This field is required":!1},render:({field:s})=>l("div",{children:[r(q,{type:"text",autoComplete:"billing address-level2",placeholder:"City",...s,value:s.value||""}),r(T,{})]})})})]}),B(e.billingAddressFields.state)&&r(D,{children:r(w,{control:g,name:"customerBillingAddress.state",rules:{required:H(e.billingAddressFields.state)?"This field is required":!1},render:({field:s})=>l(G,{children:[r(Et,{autoComplete:"billing address-level1",country:ve,value:s.value||"",onChange:s.onChange}),r(T,{})]})})}),B(e.billingAddressFields.country)&&r(D,{children:r(w,{control:g,name:"customerBillingAddress.country",rules:{required:H(e.billingAddressFields.country)?"This field is required":!1},render:({field:s})=>l(G,{children:[r(Ut,{allowedCountries:Object.values($t),autoComplete:"billing country",value:s.value||void 0,onChange:s.onChange}),r(T,{})]})})}),R.customerBillingAddress?.message&&r("p",{className:"text-destructive-foreground text-sm",children:R.customerBillingAddress.message})]}),me&&r(w,{control:g,name:"customerTaxId",render:({field:s})=>l(j,{children:[l(z,{className:"flex flex-row items-center justify-between",children:[r("div",{children:"Tax ID"}),r("div",{className:"dark:text-polar-500 text-xs text-gray-500",children:"Optional"})]}),r(D,{children:l("div",{className:"relative",children:[r(q,{type:"text",autoComplete:"off",...s,value:s.value||"",disabled:we}),l("div",{className:"absolute inset-y-0 right-1 z-10 flex items-center gap-1",children:[!we&&I&&r(oe,{type:"button",variant:"secondary",size:"sm",onClick:tt,children:"Apply"}),we&&r(oe,{type:"button",variant:"secondary",size:"sm",onClick:()=>rt(),children:r(Ge,{className:"h-4 w-4"})})]})]})}),r(T,{})]})})]}),e.allowDiscountCodes&&e.isDiscountApplicable&&r(w,{control:g,name:"discountCode",render:({field:s})=>l(j,{children:[l(z,{className:"flex flex-row items-center justify-between",children:[r("div",{children:"Discount code"}),r("div",{className:"dark:text-polar-500 text-xs font-normal text-gray-500",children:"Optional"})]}),r(D,{children:l("div",{className:"relative",children:[r(q,{type:"text",autoComplete:"off",...s,value:s.value||"",disabled:ke,onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),Fe())}}),l("div",{className:"absolute inset-y-0 right-1 z-10 flex items-center",children:[!ke&&U&&r(oe,{type:"button",variant:"secondary",size:"sm",onClick:Fe,children:"Apply"}),ke&&r(oe,{type:"button",variant:"secondary",size:"sm",onClick:fe,children:r(Ge,{className:"h-4 w-4"})})]})]})}),r(T,{})]})}),e.attachedCustomFields&&e.attachedCustomFields.map(({customField:s,required:b})=>r(w,{control:g,name:`customFieldData.${s.slug}`,rules:{required:b?"This field is required":void 0},render:({field:k})=>r(je,{customField:s,required:b,field:k,themePreset:a})},s.id))]}),!e.isFreeProductPrice&&l("div",{className:"flex flex-col gap-y-2",children:[e.currency?l(G,{children:[r(O,{title:"Subtotal",children:r(Z,{amount:e.amount,currency:e.currency,interval:d,intervalCount:c})}),e.discount&&l(G,{children:[r(O,{title:`${e.discount.name} (${Ce(e.discount)})`,children:v(-e.discountAmount,e.currency,e.discountAmount%100===0?0:2)}),r(O,{title:"Taxable amount",children:v(e.netAmount,e.currency,e.netAmount%100===0?0:2)})]}),r(O,{title:"Taxes",children:e.taxAmount!==null?v(e.taxAmount,e.currency,e.taxAmount%100===0?0:2):"\u2014"}),r(O,{title:st,emphasis:!0,children:l("div",{className:"flex flex-col items-end gap-y-1",children:[r(Z,{amount:e.totalAmount,currency:e.currency,interval:d,intervalCount:c}),Se&&r("span",{className:"text-xs font-normal text-gray-500",children:Se})]})}),Y.length>0&&r(O,{title:"Additional metered usage",emphasis:!0}),Y.map(s=>r(O,{title:s.meter.name,children:r(ye,{price:s})},s.id))]}):r("span",{children:"Free"}),(e.trialEnd||e.activeTrialInterval&&e.activeTrialIntervalCount)&&l("div",{className:"dark:border-polar-700 mt-3 border-t border-gray-300 pt-4",children:[e.activeTrialInterval&&e.activeTrialIntervalCount&&r(O,{emphasis:!0,title:`${e.activeTrialIntervalCount} ${e.activeTrialInterval}${e.activeTrialIntervalCount>1?"s":""} trial`,children:r("span",{children:"Free"})}),e.trialEnd&&l("span",{className:"dark:text-polar-500 text-gray-500:w text-sm",children:["Trial ends"," ",r(Ot,{datetime:e.trialEnd,resolution:"day"})]})]})]}),l("div",{className:"flex w-full flex-col items-center justify-center gap-y-2",children:[r(oe,{type:"submit",size:"lg",wrapperClassNames:"text-base",className:Ht("w-full"),disabled:f||y,loading:i,children:nt}),i&&m&&r("p",{className:"dark:text-polar-500 text-sm text-gray-500",children:m}),f&&!i&&r("p",{className:"text-sm text-red-500 dark:text-red-500",children:"Payments are currently unavailable"}),R.root&&r("p",{className:"text-destructive-foreground text-sm",children:R.root.message})]})]})}),r("p",{className:"dark:text-polar-500 text-center text-xs text-gray-500",children:"This order is processed by our online reseller & Merchant of Record, Polar, who also handles order-related inquiries and returns."})]}),l("a",{href:"https://polar.sh?utm_source=checkout",className:"dark:text-polar-600 flex w-full flex-row items-center justify-center gap-x-3 text-sm text-gray-400",target:"_blank",children:[r("span",{children:"Powered by"}),r(ze,{className:"h-5"})]})]})},Gt=t=>{let{checkout:e,update:o,confirm:n,loading:i,loadingLabel:m,disabled:f,isUpdatePending:y,themePreset:N}=t,{paymentProcessorMetadata:{publishable_key:a}}=e,C=J(()=>zt(a),[a]),P=J(()=>e.isPaymentSetupRequired&&e.isPaymentRequired&&e.totalAmount?{mode:"subscription",setupFutureUsage:"off_session",paymentMethodCreation:"manual",amount:e.totalAmount,currency:e.currency}:e.isPaymentRequired&&e.totalAmount?{mode:"payment",paymentMethodCreation:"manual",amount:e.totalAmount,currency:e.currency}:{mode:"setup",paymentMethodCreation:"manual",setupFutureUsage:"off_session",currency:e.currency},[e]);return r(_t,{stripe:C,options:{...P,locale:"en",customerSessionClientSecret:e.paymentProcessorMetadata.customer_session_client_secret,appearance:N.stripe},children:r(Zt,{children:({stripe:d,elements:c})=>r(Ke,{...t,checkout:e,confirm:g=>n(g,d,c),update:o,loading:i,loadingLabel:m,isUpdatePending:y,children:e.isPaymentFormRequired&&r(jt,{options:{layout:"tabs",fields:{billingDetails:{name:"never",email:"never",phone:"never",address:"never"}}}})})})})},Kt=t=>{let{checkout:e,disabled:o}=t;return r(Ke,{...t,confirm:async()=>({...e,status:"confirmed",customerSessionToken:""}),update:async()=>e,disabled:o??!0})},Yt=t=>{let{checkout:{paymentProcessor:e}}=t;return e==="stripe"?r(Gt,{...t}):r(Kt,{...t})},Xt=Yt;import{useMemo as er}from"react";import{jsx as xe,jsxs as Qt}from"react/jsx-runtime";var Jt=({product:t,price:e})=>{if(e.amountType==="fixed")return xe(Z,{amount:e.priceAmount,currency:e.priceCurrency,interval:re(e)?e.recurringInterval:t.recurringInterval,intervalCount:t.recurringIntervalCount});if(e.amountType==="custom")return xe("div",{className:"text-[min(1em,24px)]",children:"Pay what you want"});if(e.amountType==="free")return xe("div",{className:"text-[min(1em,24px)]",children:"Free"});if(e.amountType==="metered_unit")return Qt("div",{className:"flex flex-row gap-1 text-[min(1em,24px)]",children:[e.meter.name," \u2014 ",xe(ye,{price:e})]})},V=Jt;import{jsx as se,jsxs as Re}from"react/jsx-runtime";var tr=({className:t})=>Re("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[se("path",{d:"m12 14 4-4"}),se("path",{d:"M3.34 19a10 10 0 1 1 17.32 0"})]}),rr=({checkout:t})=>{let{product:e,prices:o,productPrice:n}=t,i=er(()=>he(o[e.id]).filter(m=>m.id!==n.id),[e,n]);return i.length===0?null:Re("div",{className:"text-sm",children:[se("h2",{className:"mb-2 text-base font-medium",children:"+ Additional metered usage"}),i.map(m=>Re("div",{className:"dark:text-polar-100 flex flex-row items-center gap-x-2 text-sm text-gray-600",children:[se(tr,{className:"h-4 w-4"}),se(V,{product:e,price:m})]},m.id))]})},ne=rr;import{jsx as A,jsxs as Pe}from"react/jsx-runtime";var or=({checkout:t,layout:e="default"})=>{let{product:o,productPrice:n,discount:i}=t;return!i||n.amountType!=="fixed"?A(V,{product:o,price:n}):Pe("div",{className:e==="stacked"?"flex flex-row justify-between md:flex-col md:items-start md:gap-y-2":"flex flex-row justify-between",children:[A(Z,{amount:t.netAmount,currency:t.currency,interval:re(n)?n.recurringInterval:o.recurringInterval,intervalCount:o.recurringIntervalCount}),Pe("div",{className:"flex flex-row items-center gap-x-2 text-lg",children:[A("div",{className:"text-gray-400 line-through",children:A(V,{product:o,price:n})}),Pe("div",{className:"relative rounded-xs bg-linear-to-br from-gray-400 to-gray-500 px-3 py-0.5 text-center text-sm text-white shadow-md dark:from-gray-600 dark:to-gray-700",children:[A("span",{children:Ce(i)}),A("div",{className:"dark:bg-polar-800 absolute top-1/2 left-0 -ml-1 flex h-2 w-2 -translate-y-1/2 transform rounded-full bg-gray-50"}),A("div",{className:"dark:bg-polar-800 absolute top-1/2 right-0 -mr-1 flex h-2 w-2 -translate-y-1/2 transform rounded-full bg-gray-50"})]})]})]})},sr=({checkout:t,update:e,disabled:o,layout:n="default"})=>{let{product:i,productPrice:m,amount:f}=t;return A("div",{className:"flex flex-col gap-6",children:Pe("div",{className:"flex flex-col gap-2",children:[A("h1",{className:"text-3xl font-light",children:m.amountType!=="custom"?A(or,{checkout:t,layout:n}):v(f,m.priceCurrency,0)}),A(ne,{checkout:t})]})})},nr=sr;import{RadioGroup as ir,RadioGroupItem as Ye}from"@polar-sh/ui/components/ui/radio-group";import{cn as Xe}from"@polar-sh/ui/lib/utils";import{Fragment as ar,useCallback as lr}from"react";import{jsx as L,jsxs as Q}from"react/jsx-runtime";var ur=({checkout:t,update:e,themePreset:o})=>{let{product:n,productPrice:i,products:m,prices:f}=t,y=lr(a=>{let[C,P]=a.split(":"),d=m.find(c=>c.id===C);d&&(_(f[d.id])?e?.({productId:d.id,productPriceId:P}):e?.({productId:d.id}))},[e,m]);if(m.length===1&&!_(f[m[0].id]))return null;let N=(a,C)=>{let P=_(f[a.id])?C.recurringInterval:a.recurringInterval,d=a.recurringIntervalCount;return P?`Billed ${qe(P,d)}`:"One-time purchase"};return L(ir,{value:`${n.id}:${i.id}`,onValueChange:y,className:"flex flex-col gap-2",children:m.map(a=>_(f[a.id])?L(ar,{children:f[a.id].map(C=>Q("label",{className:Xe("dark:divide-polar-700 dark:md:bg-polar-950 flex cursor-pointer flex-col divide-y divide-gray-200 rounded-2xl border shadow-xs transition-colors hover:border-blue-500 md:bg-white md:shadow-none dark:hover:border-blue-500",C.id===n.id?"border-blue-500 dark:border-blue-500":""),htmlFor:`product-${C.id}`,children:[Q("div",{className:"flex flex-row items-center gap-4 p-4",children:[L(Ye,{value:`${a.id}:${C.id}`,id:`product-${C.id}`}),Q("div",{className:"flex grow flex-row items-center justify-between text-sm",children:[L("div",{children:a.name}),L(V,{product:a,price:C})]})]}),L("div",{className:"flex grow flex-row items-center justify-between p-4 text-sm",children:L("p",{className:"dark:text-polar-500 text-gray-500",children:N(a,C)})})]},C.id))},a.id):Q("label",{className:Xe("dark:divide-polar-700 dark:md:bg-polar-950 flex cursor-pointer flex-col divide-y divide-gray-200 rounded-2xl border shadow-xs transition-colors hover:border-blue-500 md:bg-white md:shadow-none dark:hover:border-blue-500",a.id===n.id?"border-blue-500 dark:border-blue-500":""),htmlFor:`product-${a.id}`,children:[Q("div",{className:"flex flex-row items-center gap-4 p-4",children:[L(Ye,{value:`${a.id}:${f[a.id][0].id}`,id:`product-${a.id}`}),Q("div",{className:"flex grow flex-row items-center justify-between text-sm",children:[L("div",{children:a.name}),L(V,{product:a,price:f[a.id][0]})]})]}),L("div",{className:"flex grow flex-row items-center justify-between p-4 text-sm",children:L("p",{className:"dark:text-polar-500 text-gray-500",children:N(a,f[a.id][0])})})]},a.id))})},cr=ur;import mr from"@polar-sh/ui/components/atoms/MoneyInput";import{Form as dr,FormField as pr,FormItem as fr,FormLabel as Cr,FormMessage as gr}from"@polar-sh/ui/components/ui/form";import{useEffect as Je}from"react";import{useForm as hr}from"react-hook-form";import{jsx as W,jsxs as ie}from"react/jsx-runtime";var br=({className:t})=>ie("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[W("line",{x1:"12",x2:"12",y1:"2",y2:"22"}),W("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),yr=({update:t,checkout:e,productPrice:o,themePreset:n})=>{let{amount:i}=e,m=hr({defaultValues:{amount:i||0}}),{control:f,trigger:y,reset:N,watch:a}=m,C=Ae(async c=>{await y("amount")&&t?.({amount:c})},600,[t,y]);Je(()=>{let c=a(async(g,{name:ue})=>{ue==="amount"&&g.amount!==void 0&&C(g.amount)});return()=>c.unsubscribe()},[a,C]),Je(()=>{N({amount:i||0})},[i,N]);let P=null,d=null;return P=v(o.minimumAmount||50,e.currency),o.maximumAmount&&(d=v(o.maximumAmount,e.currency)),W(dr,{...m,children:ie("form",{className:"flex w-full flex-col gap-3",children:[ie(Cr,{children:["Name a fair price"," ",ie("span",{className:"text-gray-400",children:["(",P," minimum)"]})]}),W("div",{className:"flex flex-row items-center gap-2",children:W(pr,{control:f,shouldUnregister:!0,name:"amount",rules:{min:{value:o.minimumAmount||50,message:`Price must be greater than ${P}`},...o.maximumAmount?{max:{value:o.maximumAmount,message:`Price must be less than ${d}`}}:{}},render:({field:c})=>ie(fr,{className:"w-full",children:[W(mr,{className:"bg-white shadow-xs",name:c.name,value:c.value||void 0,onChange:c.onChange,placeholder:0,disabled:c.disabled,preSlot:W(br,{className:"h-4 w-4"})}),W(gr,{})]})})})]})})};import{HTTPValidationError as xr}from"@polar-sh/sdk/models/errors/httpvalidationerror";import Qe from"@polar-sh/ui/components/atoms/Button";import Pr from"@polar-sh/ui/components/atoms/Input";import{formatCurrencyAndAmount as et}from"@polar-sh/ui/lib/money";import{useEffect as vr,useState as ae}from"react";import{jsx as F,jsxs as le}from"react/jsx-runtime";var Fr=({checkout:t,update:e})=>{let[o,n]=ae(!1),[i,m]=ae(!1),[f,y]=ae(""),[N,a]=ae(null),[C,P]=ae(!1),d=p=>p instanceof xr&&p.detail?.[0]?.msg?p.detail[0].msg:"Failed to update seats",c=t.productPrice;if(!(c.amountType==="seat_based"))return null;let x=[...c.seatTiers?.tiers??[]].sort((p,I)=>p.minSeats-I.minSeats),h=x[0]?.minSeats??1,$=x[x.length-1]?.maxSeats??null,R=$!==null,M=Math.max(t.seats||h,h),ce=t.seats!==null&&t.seats!==void 0&&t.seats<h,ee=t.netAmount||0,te=c.priceCurrency,me=t.pricePerSeat||0;vr(()=>{ce&&!o&&!C&&(P(!0),e({seats:h}).catch(p=>{a(d(p))}))},[ce,h,o,e,C]);let Y=async p=>{if(!(p<h||o)&&!(R&&p>$)){n(!0),a(null);try{await e({seats:p})}catch(I){a(d(I))}finally{n(!1)}}},ve=p=>{let I=p.target.value;(I===""||/^\d+$/.test(I))&&y(I)},de=()=>{let p=parseInt(f,10);!isNaN(p)&&p>=h&&(!R||p<=$)&&p!==M&&Y(p),m(!1),y("")},pe=p=>{p.key==="Enter"?p.currentTarget.blur():p.key==="Escape"&&(m(!1),y(""))},U=()=>{m(!0),y(M.toString())},fe=h>1&&R?`${h} - ${$} seats`:h>1?`Minimum ${h} seats`:R?`Maximum ${$} seats`:null;return le("div",{className:"flex flex-col gap-6",children:[le("div",{className:"flex flex-col gap-2",children:[F("h1",{className:"text-3xl font-light text-gray-900 dark:text-white",children:et(ee,te,0)}),le("p",{className:"dark:text-polar-400 text-sm text-gray-500",children:[et(me,te,0)," per seat"]})]}),le("div",{className:"flex flex-col gap-2",children:[F("label",{className:"text-lg",children:"Number of seats"}),le("div",{className:"flex items-center gap-3",children:[F(Qe,{variant:"ghost",size:"icon",onClick:()=>Y(M-1),disabled:M<=h||o||i,className:"h-10 w-10 rounded-full disabled:opacity-40","aria-label":"Decrease seats",children:F("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:F("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})})}),i?F(Pr,{type:"text",inputMode:"numeric",value:f,onChange:ve,onBlur:de,onKeyDown:pe,autoFocus:!0,min:h,max:R?$:void 0,className:"h-auto max-w-[4.5rem] min-w-[3.5rem] py-1.5 text-center text-2xl font-light tabular-nums"}):F("button",{type:"button",onClick:U,disabled:o,className:"dark:hover:bg-polar-800 group relative min-w-[3.5rem] rounded-xl px-3 py-1.5 text-center text-2xl font-light text-gray-900 tabular-nums transition-all hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50 dark:text-white","aria-label":"Click to edit seat count",title:"Click to edit",children:F("span",{children:M})}),F(Qe,{variant:"ghost",size:"icon",onClick:()=>Y(M+1),disabled:R&&M>=$||o||i,className:"h-10 w-10 rounded-full disabled:opacity-40","aria-label":"Increase seats",children:F("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:F("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v14m-7-7h14"})})})]}),fe&&F("p",{className:"dark:text-polar-400 text-xs text-gray-500",children:fe}),N&&F("p",{className:"text-destructive-foreground text-sm",children:N})]}),F(ne,{checkout:t})]})},kr=Fr;export{Xt as CheckoutForm,yr as CheckoutPWYWForm,nr as CheckoutPricing,cr as CheckoutProductSwitcher,kr as CheckoutSeatSelector,ne as MeteredPricesDisplay};

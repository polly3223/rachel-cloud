var e="POLAR_CHECKOUT",t=class t{iframe;loader;loaded;closable;eventTarget;windowMessageListener;constructor(e,t){this.iframe=e,this.loader=t,this.loaded=!1,this.closable=!0,this.eventTarget=new EventTarget,this.windowMessageListener=this.handleWindowMessage.bind(this),window.addEventListener("message",this.windowMessageListener),this.addEventListener("loaded",this.loadedListener.bind(this)),this.addEventListener("close",this.closeListener.bind(this)),this.addEventListener("confirmed",this.confirmedListener.bind(this)),this.addEventListener("success",this.successListener.bind(this))}static postMessage(t,n){window.parent.postMessage({...t,type:e},n)}static async create(e,n){"string"==typeof n&&(console.warn(`Passing theme as string is deprecated. Use { theme: "${n}" } instead.`),n={theme:n});const s=document.createElement("style");s.innerText=`\n      .polar-loader-spinner {\n        width: 20px;\n        aspect-ratio: 1;\n        border-radius: 50%;\n        background: ${"dark"===n?.theme?"#000":"#fff"};\n        box-shadow: 0 0 0 0 ${"dark"===n?.theme?"#fff":"#000"};\n        animation: polar-loader-spinner-animation 1s infinite;\n      }\n      @keyframes polar-loader-spinner-animation {\n        100% {box-shadow: 0 0 0 30px #0000}\n      }\n      body.polar-no-scroll {\n        overflow: hidden;\n      }\n    `,document.head.appendChild(s);const o=document.createElement("div");o.style.position="absolute",o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -50%)",o.style.zIndex="2147483647",o.style.colorScheme="auto";const a=document.createElement("div");a.className="polar-loader-spinner",o.appendChild(a),document.body.classList.add("polar-no-scroll"),document.body.appendChild(o);const i=new URL(e);i.searchParams.set("embed","true"),i.searchParams.set("embed_origin",window.location.origin),n?.theme&&i.searchParams.set("theme",n.theme);const d=i.toString(),r=document.createElement("iframe");r.src=d,r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100%",r.style.height="100%",r.style.border="none",r.style.zIndex="2147483647",r.style.backgroundColor="rgba(0, 0, 0, 0.5)",r.style.colorScheme="auto";const l="https://polar.sh,https://sandbox.polar.sh".split(",").join(" ");r.allow=`payment 'self' ${l}; publickey-credentials-get 'self' ${l};`,document.body.appendChild(r);const c=new t(r,o);return n?.onLoaded&&c.addEventListener("loaded",n.onLoaded,{once:!0}),new Promise(e=>{c.addEventListener("loaded",()=>e(c),{once:!0})})}static init(){document.querySelectorAll("[data-polar-checkout]").forEach(e=>{e.removeEventListener("click",t.checkoutElementClickHandler),e.addEventListener("click",t.checkoutElementClickHandler)})}close(){window.removeEventListener("message",this.windowMessageListener),document.body.contains(this.iframe)&&document.body.removeChild(this.iframe),document.body.classList.remove("polar-no-scroll")}addEventListener(e,t,n){this.eventTarget.addEventListener(e,t,n)}removeEventListener(e,t){this.eventTarget.removeEventListener(e,t)}static async checkoutElementClickHandler(e){e.preventDefault();let n=e.target;for(;!n.hasAttribute("data-polar-checkout");){if(!n.parentElement)return;n=n.parentElement}const s=n.getAttribute("href")||n.getAttribute("data-polar-checkout"),o=n.getAttribute("data-polar-checkout-theme");t.create(s,o?{theme:o}:void 0)}loadedListener(e){e.defaultPrevented||this.loaded||(document.body.removeChild(this.loader),this.loaded=!0)}closeListener(e){e.defaultPrevented||this.closable&&this.close()}confirmedListener(e){e.defaultPrevented||(this.closable=!1)}successListener(e){e.defaultPrevented||(this.closable=!0,e.detail.redirect&&(window.location.href=e.detail.successURL))}handleWindowMessage({data:t,origin:n}){"https://polar.sh,https://sandbox.polar.sh".split(",").includes(n)&&(t.type===e&&this.eventTarget.dispatchEvent(new CustomEvent(t.event,{detail:t,cancelable:!0})))}};if("undefined"!=typeof window&&(window.Polar={EmbedCheckout:t}),"undefined"!=typeof document){const e=document.currentScript;e&&e.hasAttribute("data-auto-init")&&document.addEventListener("DOMContentLoaded",async()=>{t.init()})}export{t as PolarEmbedCheckout};